Ø¯Ù„ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª - Frontend Integration
ğŸ”” Socket.io - Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:

ØªÙ… ØªÙˆØ­ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø£Ø­Ø¯Ø§Ø« Socket.io Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª. Ø§Ù„Ø¢Ù† ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙØ±Ø³Ù„ Ø¹Ø¨Ø± Ø­Ø¯Ø« ÙˆØ§Ø­Ø¯: new_notification
âŒ Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ù„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡):

// âŒ Ø§Ù„Ù‚Ø¯ÙŠÙ… - Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¢Ù†
socket.on('job:notification', (data) => {
  // ...
});

âœ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§):

// âœ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ - ÙŠØ¹Ù…Ù„ Ù„ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
socket.on('new_notification', (notification) => {
  console.log('Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯:', notification);
  
  // ØªØ­Ø¯ÙŠØ« UI
  updateNotificationsUI(notification);
});

ğŸ“‹ Ø£Ù†ÙˆØ§Ø¹ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
1ï¸âƒ£ Ù„Ù„Ù†Ø§Ø¯ÙŠ (Club):
Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ ØªÙˆØ¸ÙŠÙ Ø¬Ø¯ÙŠØ¯:

{
  _id: "notification_id",
  type: "job_application",           // Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
  notificationType: "new_application", // Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ
  applicationId: "app_id",
  jobId: "job_id",
  jobTitle: "Ù…Ø¯Ø±Ø¨ ÙƒØ±Ø© Ù‚Ø¯Ù…",
  jobTitleAr: "Ù…Ø¯Ø±Ø¨ ÙƒØ±Ø© Ù‚Ø¯Ù…",
  applicantName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
  clubName: "Ø§Ù„Ù†Ø§Ø¯ÙŠ Ø§Ù„Ø£Ù‡Ù„ÙŠ",
  title: "New Job Application",
  titleAr: "Ø·Ù„Ø¨ ØªÙˆØ¸ÙŠÙ Ø¬Ø¯ÙŠØ¯",
  message: "Ahmed Mohamed applied for Coach position",
  messageAr: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ ØªÙ‚Ø¯Ù… Ù„ÙˆØ¸ÙŠÙØ© Ù…Ø¯Ø±Ø¨ ÙƒØ±Ø© Ù‚Ø¯Ù…",
  actionUrl: "/club/applications/app_id",
  userId: "club_user_id",
  status: "new",
  priority: "normal",
  isRead: false,
  createdAt: "2025-11-24T18:00:00.000Z",
  storedIn: "mongodb" // Ø£Ùˆ "memory"
}

2ï¸âƒ£ Ù„Ù„Ù…ØªÙ‚Ø¯Ù… (Applicant):
Ø£) ØªØ£ÙƒÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨:

{
  _id: "notification_id",
  type: "job_application",
  notificationType: "application_submitted",
  applicationId: "app_id",
  jobId: "job_id",
  jobTitle: "Ù…Ø¯Ø±Ø¨ ÙƒØ±Ø© Ù‚Ø¯Ù…",
  title: "Application Submitted",
  titleAr: "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ",
  message: "Your application for Coach has been submitted successfully",
  messageAr: "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ù„ÙˆØ¸ÙŠÙØ© Ù…Ø¯Ø±Ø¨ ÙƒØ±Ø© Ù‚Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­",
  actionUrl: "/jobs/job_id/application/app_id",
  priority: "normal",
  isRead: false
}

Ø¨) Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:

{
  type: "job_application",
  notificationType: "application_reviewed",
  title: "Application Under Review",
  titleAr: "Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",
  message: "Your application is now under review",
  priority: "high"
}

Ø¬) Ø¬Ø¯ÙˆÙ„Ø© Ù…Ù‚Ø§Ø¨Ù„Ø©:

{
  type: "job_application",
  notificationType: "interview_scheduled",
  title: "Interview Scheduled",
  titleAr: "ØªÙ… Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©",
  interviewDate: "2025-11-30T10:00:00.000Z",
  priority: "high"
}

Ø¯) Ø§Ø³ØªÙ„Ø§Ù… Ø¹Ø±Ø¶ Ø¹Ù…Ù„:

{
  type: "job_application",
  notificationType: "job_offer_received",
  title: "Job Offer Received!",
  titleAr: "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„!",
  offerDetails: {
    salary: 5000,
    startDate: "2025-12-01",
    // ...
  },
  priority: "urgent"
}

Ù‡Ù€) Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:

{
  type: "club_accepted",
  notificationType: "application_accepted",
  title: "Congratulations - You Are Hired!",
  titleAr: "ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ - ØªÙ… Ù‚Ø¨ÙˆÙ„Ùƒ!",
  priority: "urgent"
}

Ùˆ) Ø§Ù„Ø±ÙØ¶:

{
  type: "club_rejected",
  notificationType: "application_rejected",
  title: "Application Update",
  titleAr: "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨",
  priority: "normal"
}

ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© (CV/Resume/Documents)
Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:

Ø§Ù„Ù…Ù„ÙØ§Øª ÙƒØ§Ù†Øª ØªÙØ­Ù…Ù‘Ù„ Ø¨ØµÙŠØºØ© ØºØ±ÙŠØ¨Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù… Ø£Ùˆ Ù†ÙˆØ¹ ØµØ­ÙŠØ­.
âœ… Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯:
Endpoint Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ­Ù…ÙŠÙ„:

GET /api/v1/jobs/applications/:applicationId/download/:attachmentIndex

Ù…Ø«Ø§Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…:

// 1. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
const application = await fetch('/api/v1/jobs/:jobId/applications', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
}).then(res => res.json());

// 2. Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©
application.attachments.forEach((attachment, index) => {
  console.log({
    name: attachment.name,              // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ
    type: attachment.type,              // resume, cv, certificate, etc.
    uploadedAt: attachment.uploadedAt,  // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹
    downloadLink: `/api/v1/jobs/applications/${application._id}/download/${index}`
  });
});

// 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù (React/Vue/Angular)
const downloadFile = async (applicationId, attachmentIndex) => {
  const response = await fetch(
    `/api/v1/jobs/applications/${applicationId}/download/${attachmentIndex}`,
    {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    }
  );
  
  // Ø§Ù„Ù…Ù„Ù Ø³ÙŠÙØ­Ù…Ù‘Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù…Ø¹ Ø§Ø³Ù…Ù‡ Ø§Ù„Ø£ØµÙ„ÙŠ
  const blob = await response.blob();
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = ''; // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø³ÙŠØ£ØªÙŠ Ù…Ù† Content-Disposition header
  document.body.appendChild(a);
  a.click();
  window.URL.revokeObjectURL(url);
  document.body.removeChild(a);
};

// 4. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¨Ø§Ø´Ø± (HTML)
<a 
  href={`/api/v1/jobs/applications/${applicationId}/download/${index}`}
  download
  target="_blank"
>
  ØªØ­Ù…ÙŠÙ„ {attachment.name}
</a>

ğŸ”’ Ø§Ù„Ø£Ù…Ø§Ù† (Authorization)

Ø§Ù„Ù€ endpoint ÙŠØªØ­Ù‚Ù‚ Ù…Ù†:

    âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ (JWT token)
    âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù…Ø§ ØµØ§Ø­Ø¨ Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ù†Ø§Ø¯ÙŠ ÙÙ‚Ø·

ğŸ¯ Ù…Ø«Ø§Ù„ ÙƒØ§Ù…Ù„ - React Component

import { useEffect, useState } from 'react';
import { io } from 'socket.io-client';

function JobNotifications() {
  const [notifications, setNotifications] = useState([]);
  const [socket, setSocket] = useState(null);

  useEffect(() => {
    // 1. Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Socket.io
    const newSocket = io('https://your-backend-api.com', {
      auth: {
        token: localStorage.getItem('token')
      }
    });

    // 2. Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    newSocket.on('new_notification', (notification) => {
      console.log('ğŸ”” Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯:', notification);
      
      // ÙÙ„ØªØ±Ø© Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ÙÙ‚Ø·
      if (notification.type === 'job_application' || 
          notification.type === 'club_accepted' || 
          notification.type === 'club_rejected') {
        
        setNotifications(prev => [notification, ...prev]);
        
        // Ø¹Ø±Ø¶ Toast/Alert
        showToast({
          title: notification.titleAr || notification.title,
          message: notification.messageAr || notification.message,
          type: notification.priority === 'urgent' ? 'success' : 'info'
        });
      }
    });

    setSocket(newSocket);

    return () => newSocket.close();
  }, []);

  // 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
  const handleDownload = async (applicationId, index, filename) => {
    try {
      const response = await fetch(
        `/api/v1/jobs/applications/${applicationId}/download/${index}`,
        {
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          }
        }
      );
      
      if (!response.ok) throw new Error('Download failed');
      
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);
    } catch (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:', error);
      alert('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù');
    }
  };

  return (
    <div className="notifications">
      <h2>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
      {notifications.map(notification => (
        <div key={notification._id} className="notification-card">
          <h3>{notification.titleAr || notification.title}</h3>
          <p>{notification.messageAr || notification.message}</p>
          <small>{new Date(notification.createdAt).toLocaleString('ar-EG')}</small>
          
          {notification.actionUrl && (
            <a href={notification.actionUrl}>Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</a>
          )}
        </div>
      ))}
    </div>
  );
}

export default JobNotifications;

ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:

    ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¢Ù† Ø¹Ø¨Ø± new_notification ÙÙ‚Ø·
    Ø§Ø³ØªØ®Ø¯Ù… notificationType Ù„Ù„ØªÙØ±ÙŠÙ‚ Ø¨ÙŠÙ† Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
    Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¢Ù† ØªÙØ­Ù…Ù‘Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù…Ø¹ Ø£Ø³Ù…Ø§Ø¦Ù‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠØ©
    Headers ØµØ­ÙŠØ­Ø©: Content-Type Ùˆ Content-Disposition
    Authorization Ù…Ø·Ù„ÙˆØ¨Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª

ğŸš€ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹:

# Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:3000/api/v1/jobs/applications/APP_ID/download/0 \
  --output resume.pdf

ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! âœ…